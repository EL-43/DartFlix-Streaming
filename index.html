import React, { useEffect, useRef, useState } from 'react';
import './CSS/index.css';

export default function App() {
  const [loading, setLoading] = useState(true);
  const [searchOpen, setSearchOpen] = useState(false);
  const [videoOpen, setVideoOpen] = useState(false);
  const [sidebarOpen, setSidebarOpen] = useState(false);
  const [searchQuery, setSearchQuery] = useState('');
  const [searchResults, setSearchResults] = useState([]);
  const mainVideoRef = useRef(null);

  useEffect(() => {
    const t = setTimeout(() => setLoading(false), 600);
    return () => clearTimeout(t);
  }, []);

  useEffect(() => {
    const titles = [
      'Action Blockbuster', 'Drama Series', 'Fantasy Epic', 'Anime Collection',
      'Superhero Chronicles', 'Space Odyssey', 'Mystery Thriller', 'Romantic Comedy',
      'Royal Dynasty', 'Science Fiction', 'Medical Drama', 'Crime Investigation',
      'Power Academy', 'Samurai Legend', 'Romance Blossom', 'Mecha Warriors'
    ];
    if (!searchQuery.trim()) return setSearchResults([]);
    const q = searchQuery.toLowerCase();
    setSearchResults(titles.filter(t => t.toLowerCase().includes(q)));
  }, [searchQuery]);

  function playVideo(src) {
    setVideoOpen(true);
    // set source if provided
    if (mainVideoRef.current && src) {
      mainVideoRef.current.src = src;
    }
    // autoplay when opened
    setTimeout(() => mainVideoRef.current?.play?.(), 50);
  }

  function closeVideo() {
    mainVideoRef.current?.pause?.();
    setVideoOpen(false);
  }

  function toggleSearch() {
    setSearchOpen(s => !s);
    setSearchQuery('');
  }

  return (
    <div className="app-root">
      {/* Loading Screen */}
      {loading && (
        <div className="loading" id="loading">
          <div className="spinner" />
        </div>
      )}

      {/* Navigation */}
      <nav className="navbar" id="navbar">
        <div className="nav-content">
          <div className="logo">Dartplex movie</div>
          <ul className="nav-links">
            <li><a href="#home">Home</a></li>
            <li><a href="#movies">Movies</a></li>
            <li><a href="#series">TV Series</a></li>
            <li><a href="#anime">Anime</a></li>
            <li><a href="#my-list">My List</a></li>
          </ul>
          <div className="user-profile">
            <button className="search-btn" onClick={toggleSearch} aria-label="Search" />
            <button className="profile-btn" aria-label="Profile" />
            <button className="hamburger" onClick={() => setSidebarOpen(s => !s)} aria-label="Menu">☰</button>
          </div>
        </div>
      </nav>

      {/* Sidebar Menu (for mobile) */}
      <div className={`sidebar ${sidebarOpen ? 'open' : ''}`} id="sidebar">
        <ul className="sidebar-menu">
          <li><a href="#home" onClick={() => setSidebarOpen(false)}>Home</a></li>
          <li><a href="#movies" onClick={() => setSidebarOpen(false)}>Movies</a></li>
          <li><a href="#series" onClick={() => setSidebarOpen(false)}>TV Series</a></li>
          <li><a href="#anime" onClick={() => setSidebarOpen(false)}>Anime</a></li>
          <li><a href="#my-list" onClick={() => setSidebarOpen(false)}>My List</a></li>
          <li><a href="#settings" onClick={() => setSidebarOpen(false)}>Settings</a></li>
          <li><a href="#help" onClick={() => setSidebarOpen(false)}>Help</a></li>
        </ul>
      </div>

      {/* Search Overlay */}
      {searchOpen && (
        <div className="search-overlay" id="searchOverlay" onClick={(e) => { if (e.target === e.currentTarget) setSearchOpen(false); }}>
          <div className="search-container">
            <input
              type="text"
              className="search-input"
              placeholder="Search movies, TV shows, anime..."
              id="searchInput"
              value={searchQuery}
              onChange={e => setSearchQuery(e.target.value)}
              autoFocus
            />
            <div className="search-results" id="searchResults">
              {searchResults.length === 0 && searchQuery && <div className="no-results">No results</div>}
              {searchResults.map(r => (
                <div key={r} className="search-item" onClick={() => { playVideo(); setSearchOpen(false); }}>
                  {r}
                </div>
              ))}
            </div>
          </div>
        </div>
      )}

      {/* Video Player Overlay */}
      {videoOpen && (
        <div className="video-overlay" id="videoOverlay" onClick={(e) => { if (e.target === e.currentTarget) closeVideo(); }}>
          <div className="video-player">
            <button className="close-video" onClick={closeVideo}>✕</button>
            <video id="mainVideo" controls ref={mainVideoRef}>
              <source src="your-video.mp4" type="video/mp4" />
              Your browser does not support the video tag.
            </video>
          </div>
        </div>
      )}

      {/* Hero Section */}
      <section className="hero" id="home">
        <div className="hero-content">
          <h1>Unlimited Entertainment</h1>
          <p>
            Stream thousands of movies, TV shows, and anime series in stunning
            quality. Watch anywhere, anytime, on any device.
          </p>
          <div className="cta-buttons">
            <button className="btn btn-primary" onClick={() => playVideo()}>Start Watching</button>
            <a href="#features" className="btn btn-secondary">Learn More</a>
          </div>
        </div>
      </section>

      {/* Trending Section */}
      <section className="content-section fade-in" id="trending">
        <h2 className="section-title">Trending Now</h2>
        <div className="content-grid">
          {['Action Blockbuster','Drama Series','Fantasy Epic','Anime Collection'].map(title => (
            <div key={title} className="content-card" onClick={() => playVideo()}>
              <div className="card-image" />
              <div className="card-title">{title}</div>
              <div className="card-description">Description for {title}.</div>
            </div>
          ))}
        </div>
      </section>

      {/* Movies Section */}
      <section className="content-section fade-in" id="movies">
        <h2 className="section-title">Popular Movies</h2>
        <div className="content-grid">
          {['Superhero Chronicles','Space Odyssey','Mystery Thriller','Romantic Comedy'].map(t => (
            <div key={t} className="content-card" onClick={() => playVideo()}>
              <div className="card-image" />
              <div className="card-title">{t}</div>
              <div className="card-description">Short description for {t}.</div>
            </div>
          ))}
        </div>
      </section>

      {/* TV Series Section */}
      <section className="content-section fade-in" id="series">
        <h2 className="section-title">Binge-Worthy Series</h2>
        <div className="content-grid">
          {['Royal Dynasty','Science Fiction','Medical Drama','Crime Investigation'].map(t => (
            <div key={t} className="content-card" onClick={() => playVideo()}>
              <div className="card-image" />
              <div className="card-title">{t}</div>
              <div className="card-description">Short description for {t}.</div>
            </div>
          ))}
        </div>
      </section>

      {/* Anime Section */}
      <section className="content-section fade-in" id="anime">
        <h2 className="section-title">Latest Anime</h2>
        <div className="content-grid">
          {['Power Academy','Samurai Legend','Romance Blossom','Mecha Warriors'].map(t => (
            <div key={t} className="content-card" onClick={() => playVideo()}>
              <div className="card-image" />
              <div className="card-title">{t}</div>
              <div className="card-description">Short description for {t}.</div>
            </div>
          ))}
        </div>
      </section>

      {/* Features Section */}
      <section className="content-section" id="features">
        <div className="features fade-in">
          <h2 className="section-title">Why Choose Dartplex</h2>
          <div className="features-grid">
            {[
              ['4K Ultra HD','Experience crystal-clear picture quality with support for 4K Ultra HD streaming on compatible devices.'],
              ['Any Device','Watch on your TV, computer, tablet, or smartphone - seamlessly across all your devices.'],
              ['Download & Go','Download your favorite content to watch offline, perfect for travel or when you're on the move.'],
              ['Family Friendly','Create separate profiles for family members with personalized recommendations and parental controls.'],
              ['Global Content','Access content from around the world with subtitles and dubbing in multiple languages.'],
              ['Auto-Resume','Pick up exactly where you left off on any device with seamless cross-platform synchronization.']
            ].map(([title, desc]) => (
              <div key={title} className="feature-item">
                <div className="feature-icon" />
                <h3 className="feature-title">{title}</h3>
                <p>{desc}</p>
              </div>
            ))}
          </div>
        </div>
      </section>

      {/* My List Section */}
      <section className="content-section fade-in" id="my-list">
        <h2 className="section-title">My List</h2>
        <div className="content-grid">
          {['Watchlist Item 1','Recommended for You','Recently Added','Favorites'].map(t => (
            <div key={t} className="content-card" onClick={() => playVideo()}>
              <div className="card-image" />
              <div className="card-title">{t}</div>
              <div className="card-description">Short description for {t}.</div>
            </div>
          ))}
        </div>
      </section>

      {/* Footer */}
      <footer className="footer">
        <div className="footer-content">
          <div className="footer-links">
            <a href="#about">About Us</a>
            <a href="#help">Help Center</a>
            <a href="#terms">Terms of Service</a>
            <a href="#privacy">Privacy Policy</a>
            <a href="#contact">Contact Support</a>
            <a href="#careers">Careers</a>
            <a href="#press">Press</a>
          </div>
          <p>&copy; 2026 dartplex. All rights reserved. Made with for entertainment lovers.</p>
        </div>
      </footer>
    </div>
  );
}
